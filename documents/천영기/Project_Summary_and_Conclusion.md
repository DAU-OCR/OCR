# OCR 프로젝트 최종 정리 보고서

## 1. 초기 목표

프로젝트의 초기 목표는 다음과 같았습니다.
1.  OCR 결과를 JSON 파일로 내려받는 기능 추가.
2.  결과 테이블에서 키보드로 항목을 이동하고 수정하는 기능 추가.
3.  전체 프로그램을 하나의 `exe` 설치 파일로 패키징.

## 2. 완료된 기능

위 목표에 따라 아래 기능들은 성공적으로 구현 및 수정되었습니다.

*   **JSON 내보내기:** 결과 페이지에 'JSON으로 내보내기' 버튼을 추가하고, 서버 API를 구현하여 OCR 결과물을 JSON 파일로 저장하는 기능을 완료했습니다.
*   **키보드 네비게이션:** 결과 페이지의 테이블에서 키보드 화살표(↑, ↓)로 행을 이동하고, 선택된 행의 입력창에 자동으로 포커스를 맞춰 바로 수정할 수 있는 기능을 완료했습니다.
*   **서버-앱 연동 로직 개선:** Electron 앱이 Python 서버를 실행하는 방식(작업 디렉토리 지정)과 서버 내부의 모델 파일 경로(절대 경로 변환)를 수정하여 패키징된 환경에서의 안정성을 높였습니다.

## 3. 핵심 난관: 프로그램 패키징 디버깅

가장 어렵고 긴 시간을 소요한 부분은 전체 프로그램을 하나의 실행 파일로 만드는 과정에서 발생한 여러 복합적인 오류들을 해결하는 것이었습니다.

### 3.1. 서버 빌드 과정 (`ocr_server.exe`)

`PyInstaller`를 사용한 서버 실행 파일 빌드 과정에서 다음과 같은 주요 오류들을 순차적으로 해결했습니다.

1.  **CUDA 라이브러리 충돌:** `torch` 라이브러리가 GPU 관련 파일을 로드하다 발생하는 문제를 해결하기 위해, CPU만 사용하도록 강제하고 관련 DLL 파일을 빌드에서 제외했습니다.
2.  **`ModuleNotFoundError`:** PyInstaller가 `torch._dynamo`의 하위 모듈들을 찾지 못하는 문제를 해결하기 위해, 필요한 모듈들을 빌드 설정(`.spec` 파일)에 수동으로 추가했습니다.
3.  **`PackageNotFoundError`:** `torchvision` 라이브러리의 버전 정보를 찾지 못하는 문제를 해결하기 위해, 관련 메타데이터를 빌드에 포함시켰습니다.

**결과:** 위 과정을 통해 **단독으로 실행하면 완벽하게 동작하는 안정적인 `ocr_server.exe`를 성공적으로 만들었습니다.**

### 3.2. 앱-서버 연동 런타임 오류

`electron-builder`로 패키징된 앱이 `ocr_server.exe`를 실행시키는 과정에서 다음과 같은 런타임 오류들을 진단하고 해결했습니다.

1.  **`500 Internal Server Error` (데이터 타입 불일치):** 서버의 YOLO 모델이 예상하는 데이터 타입(`Tensor`)과 실제 입력된 이미지의 데이터 타입(`Numpy`)이 달라 발생하는 문제임을 확인하고, 이미지 타입을 명시적으로 변환하도록 코드를 수정했습니다.
2.  **`forrtl: error (200)` (네이티브 라이브러리 충돌):** 위 문제 해결 후, `torch`의 기반이 되는 Intel Fortran 라이브러리에서 매우 낮은 수준의 충돌이 발생하는 것을 확인했습니다.

## 4. 최종 결론

*   **성공한 부분:**
    1.  Python 서버(`ocr_server.exe`)는 이제 단독으로 실행하면 완벽하게 동작하는 안정적인 빌드가 되었습니다.
    2.  Electron 앱(`ocr-web.exe`) 또한 포터블(무설치) 버전으로 성공적으로 빌드되었습니다.

*   **해결되지 않은 문제:**
    *   Electron 앱이 `ocr_server.exe`를 '자식 프로세스'로 자동 실행시키는 특수한 환경에서만, 원인을 특정하기 어려운 매우 낮은 수준의 라이브러리 호환성 충돌(`forrtl` 오류)이 발생합니다.

*   **결론:**
    *   이 호환성 문제는 더 이상 코드나 설정을 수정하여 원격으로 해결하기 어려운, 실행 환경의 특수성으로 인한 문제입니다.
    *   따라서, **두 프로그램을 하나의 `exe`로 합쳐 자동으로 실행시키는 것은 현재 환경에서 불가능**하다고 판단됩니다.


pyinstaller ocr_server.spec