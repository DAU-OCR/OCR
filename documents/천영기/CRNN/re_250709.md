# 추론용 전처리 스크립트 개선 및 오류 수정 (2025-07-09)

## 1. 개요

기존의 학습 데이터 생성용 스크립트(`preprocess_craft_split.py`)는 복잡하여 단순 추론에 사용하기 어려웠다. 이에, 단일 이미지(또는 폴더)를 입력받아 기울기 보정, 대비 향상 등 순수 전처리 및 CRAFT 기반 텍스트 영역 추출만 수행하는 경량화된 `ocr/scripts/preprocess_simple.py` 스크립트를 새로 작성했다. 또한, 스크립트 실행 과정에서 발견된 여러 버그를 수정하여 안정성을 높이는 작업을 진행했다.

---

## 2. 주요 변경 및 개선 사항

### 가. 추론용 스크립트 신규 생성 (`preprocess_simple.py`)

- **목적**: 학습 데이터 생성 로직(라벨 매칭, 분할 등)을 모두 제거하고, 이미지 전처리 및 CRAFT 영역 추출이라는 핵심 기능에만 집중하는 스크립트를 새로 작성하여 역할을 명확히 분리했다.
- **기능**: 이미지(또는 폴더)를 입력받아 기울기 보정, 대비 향상 후, CRAFT로 감지된 텍스트 영역을 개별 파일로 잘라 저장한다.

### 나. 폴더 단위 일괄 처리 기능 추가

- **문제**: 초기 버전은 단일 파일만 처리할 수 있어 사용이 불편했다.
- **개선**: 사용 편의성을 높이기 위해, 단일 파일 경로뿐만 아니라 폴더 경로를 입력받아 해당 폴더 내의 모든 이미지 파일을 한 번에 처리할 수 있도록 기능을 확장했다.

---

## 3. 버그 수정 및 안정성 강화

### 가. 런타임 오류 수정
- **문제**: CRAFT가 텍스트를 감지하지 못했을 때 `The truth value of an array... is ambiguous` 오류가 발생했다.
- **해결**: `if not boxes` 조건문이 NumPy 배열을 올바르게 평가하지 못하는 문제였다. 이를 배열의 길이를 명시적으로 확인하는 `if len(boxes) == 0`으로 변경하여 오류를 해결했다.

### 나. 기울기 보정 로직 개선
- **문제**: `deskew` 함수가 가로로 긴 번호판 이미지를 세로로 잘못 회전시키는 현상이 발생했다.
- **해결**: `cv2.minAreaRect`가 반환하는 박스의 가로/세로 비율을 먼저 확인하도록 로직을 수정했다. 박스가 세로로 긴 경우(너비 < 높이)에만 90도 각도 보정을 적용하여, 불필요한 회전을 방지했다.
